<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
 	<meta http-equiv="content-type" content="text/html;charset=gb2312">
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="icon" href="#">
	<script>
        !function(e,t,i,r){function n(){var e=document.querySelector("head"),t=document.createElement("div");t.style.width="1rem",t.style.display="none",e.appendChild(t);var i=parseFloat(window.getComputedStyle(t,null).width);return e.removeChild(t),i}function a(){var r=d.getBoundingClientRect().width;r/c>768&&(r=768*c);var n=r/e*t;if(!i){var a=p/16;n/=a}d.style.fontSize=n+"px",v.rem=n}var m,o=window,l=o.document,d=l.documentElement,s=l.querySelector('meta[name="viewport"]'),c=0,u=0,p=n(),v={};if(s){var h=s.getAttribute("content").match(/initial\-scale=([\d\.]+)/);h&&(console.warn("将根据已有的meta标签来设置缩放比例"),u=parseFloat(h[1]),c=parseInt(1/u))}if(!c&&!u){var f=o.devicePixelRatio;r?(c=f>=3&&(!c||c>=3)?3:f>=2&&(!c||c>=2)?2:1,u=1/c):(c=1,u=1/c)}if(d.setAttribute("data-dpr",c),!s)if(s=l.createElement("meta"),s.setAttribute("name","viewport"),s.setAttribute("content","width=device-width, initial-scale="+u+", maximum-scale="+u+", minimum-scale="+u+", user-scalable=no"),d.firstElementChild)d.firstElementChild.appendChild(s);else{var w=l.createElement("div");w.appendChild(s),l.write(w.innerHTML)}o.addEventListener("resize",function(){clearTimeout(m),m=setTimeout(a,300)},!1),o.addEventListener("pageshow",function(e){e.persisted&&(clearTimeout(m),m=setTimeout(a,300))},!1),a(),v.dpr=c,v.refreshRem=a,v.rem2px=function(e){var t=parseFloat(e)*this.rem;return"string"==typeof e&&e.match(/rem$/)&&(t+="px"),t},v.px2rem=function(e){var t=parseFloat(e)/this.rem;return"string"==typeof e&&e.match(/px$/)&&(t+="rem"),t},window.remmoka=v}
        (750,100,!0,!0);
        /*
         * designWidth, oneRem2Px, resetScaleFontSizeToDefault, useScaleFix1pxTooBold
         * @param designWidth 设计稿宽度 一般来说iPhone6是750 如果缩小就变成了375px
         * @param oneRem2Px 1rem对应多少px
         * @param resetScaleFontSizeToDefault 是否重置Android因为系统放大或者缩小字体带来的影响
         * @param useScaleFix1pxTooBold 是否通过meta标签的scale处理1px过于粗的问题
         * */
    </script>    	
	<title>商品详情</title>
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body >
<div id="page" class="goods">
	<header class="goods-header">
		<img :src="goodsInfo.wineImg" style="width:100%;height:6.8rem">
	</header>
	<section class="goods-section">
		<div class="goods-brief">
			{{goodsInfo.wineBrand}}{{goodsInfo.wineClass}}{{goodsInfo.wineName}}
		</div>
		<div class="goods-price">￥{{goodsInfo.winePrice}}</div>
		<div class="goods-infor">
			<div class="fast-mail">快递：免费</div>
			<div class="sales-volume">库存<span>{{goodsInfo.wineStock}}</span>件</div>
		</div>
		<div class="check-number">
			<div class="number" @click="isShow = !isShow">选择数量</div>
			<div class="check" @click="isShow = !isShow"><img src="img/goods/arrow.png" style="width:0.rem;height:0.3rem">
			</div>
		</div>
		<div class="product-parameter">
			<div class="parameter" @click="activeShow = !activeShow">产品参数</div>
			<div class="check"  @click="activeShow = !activeShow"><img src="img/goods/arrow.png" style="width:0.25rem;height:0.3rem">
			</div>
		</div>
		<div class="remark-on">
			<div class="remark" @click="isActive = !isActive">
				<img src="img/goods/pen.png" style="width:0.35rem;height:0.35rem">
				<span>修改</span>
			</div>
			<div class="check" @click="isActive = !isActive"><img src="img/goods/arrow.png" style="width:0.25rem;height:0.3rem">
			</div>			
		</div>

	</section>
	<!--底部导航-->
	<footer>
		<ul class="footer-list">
			<li>
				<a :href="'./index.html?userId='+this.userId"><img src="img/footer/home-y.png" style="width:0.58rem;height:0.52rem"></a>
				<span>首页</span>
			</li>
			<li>
				<a :href="'./shopping_cart.html?userId='+this.userId"><img src="img/footer/shoppingcart.png" style="width:0.58rem;height:0.52rem"></a>
				<span>购物车</span>
			</li>
			<li>
				<a :href="'./personCenter.html?userId='+this.userId"><img src="img/footer/my.png" style="width:0.58rem;height:0.52rem"></a>
				<span>我的</span>
			</li>
		</ul>
	</footer>
	<div class="pop-up" v-show="isShow">
		<div class="liitle">
			<div class="picture">
				<img src="img/goods/littlePictrue.png" style="width:2.2rem;height:2rem">
			</div>
			<div class="choice">
				<p class="price">￥{{goodsInfo.winePrice}}</p>
				<p class="overplus">库存<span>{{goodsInfo.wineStock}}</span>件</p>
				<p class="number" >请选择数量</p>
			</div>
			<div class="error" @click="isShow = !isShow">
				<img src="img/goods/error.png" style="width:0.4rem;height:0.4rem"  >
			</div>
		</div>
		<div class="goods-number" >
			<div class="title">数量：</div>
			<div class="minus" @click="num > 1 ? num-- : 1 ">-</div>
			<span>{{num}}</span>
			<div class="add" @click="num<goodsInfo.wineStock ? num++ : goodsInfo.wineStock">+</div>
		</div>
		<button class="confirm" @click="addPro()">
			加入购物车
		</button>
	</div>
	<div class="goods-parameter" v-show="activeShow">
		<div class="tip">产品参数</div>
		<ul>
			<li>
				<div>年份</div>
				<div>{{goodsInfo.wineYear}}</div>
			</li>
			<li>
				<div>产地</div>
				<div>{{goodsInfo.wineAddress}}</div>
			</li>
			<li>
				<div>评分</div>
				<div>{{goodsInfo.wineScore}}</div>
			</li>
		</ul>
	</div>
	<div class="modify" v-show="isActive">
		<div class="tip">更新商品信息</div>
		<ul>
			<li>
				库存：<input type="text" class="number" v-model="goodsInfo.wineStock">
				<input type="button" value="更改库存" @click="modifyStock()">
			</li>
			<li>
				价钱：<input type="text" class="price" v-model="goodsInfo.winePrice">
				<input type="button" value="更改价钱" @click="modifyPrice()">
			</li>
		</ul>
	</div>
</div>
	<script type="text/javascript" src="./js/lib/vue.min.js"></script>
	<script type="text/javascript" src="./js/lib/jquery.min.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
		var instance = axios.create({
            header:{contentType: 'application/x-www-form-urlencoded'}
		})
		new Vue({
			el:"#page",
			data:{
				num:1,
				isShow:false,
				activeShow:false,
				isActive:false,
				goodsInfo:[],
				userId:''
			},
			methods: {
				addPro:function(){
					console.log(this.num);
					var that = this;
					instance({
						method:"POST",
						url:"http://dreamjxw.imwork.net:80/jxw/design/shopcart/insert.htm",
						data:{
							"userId":that.userId,
							"wineId":that.goodsInfo.wineId,
							"wineNum":that.num
						},
						contentType: 'Access-Control-Allow-Origin',
					}).then(function(res){
								console.log(res.data);
								alert("成功加入购物车！");
							},
							function(error){
								console.log(error)
							})
				},
				modifyStock:function(){
					var that = this;
					instance({
						method:"POST",
						url:"http://dreamjxw.imwork.net:80/jxw/design/wine/addStock.htm",
						data:{
							"wineId":that.goodsInfo.wineId,
							"wineStock":that.goodsInfo.wineStock
						},
						contentType: 'Access-Control-Allow-Origin',
					}).then(function(res){
								console.log(res.data);
							},
							function(error){
								console.log(error)
							})
				},
				modifyPrice:function(){
					var that = this;
					instance({
						method:"POST",
						url:"http://dreamjxw.imwork.net:80/jxw/design/wine/updateWine.htm",
						data:{
							"message":that.userId,
							"wineId":that.goodsInfo.wineId,
							"winePrice":that.goodsInfo.winePrice
						},
						contentType: 'Access-Control-Allow-Origin',
					}).then(function(res){
								console.log(res.data);
							},
							function(error){
								console.log(error)
							})
				}
			},
			mounted () {
				function queryString(key){
				var src = location.search || location.hash,
				reg = new RegExp('[?&]' + key + '=([^?&=]*)(?=&|$)'),
				match = reg.exec(src);
				return match == null ? null : decodeURIComponent(match[1]);
			}
				var  wineId= queryString('id');
				var userId = queryString('userId')
				this.userId = userId;
//				console.log(typeof (wineId));
				console.log(queryString('id'));
				console.log(queryString('userId'));

				var that = this;
				instance({
					method:"POST",
					url:"http://dreamjxw.imwork.net:80/jxw/design/wine/wineInfo.htm",
					data:wineId,
					contentType: 'Access-Control-Allow-Origin',
				}).then(function(res){
					console.log(res.data);
					that.goodsInfo = res.data.data;
					console.log(that.goodsInfo);
				},
				function(error){
				console.log(error)
			})
			}
		})
	</script>
</body>
</html>